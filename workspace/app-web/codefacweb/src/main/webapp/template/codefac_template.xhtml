<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <f:view contentType="text/html">
        <h:head>
            <f:facet name="first">
                <meta http-equiv="X-UA-Compatible" content="IE=edge" />
                <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
                <meta name="apple-mobile-web-app-capable" content="yes" />
                <h:outputStylesheet library="css" name="estilo.css" />
                <title>Codefac</title>
            </f:facet>

            <!--<f:metadata>
                <f:viewAction action="#{applicationCodefacMb.controladorConexionServidor()}" />
            </f:metadata>-->
        </h:head>

        <h:body style="font-size: 11px">

            <h:form id="formulario" target="_blank" onkeypress="if (event.keyCode == 13) {
                        return false;
                    }">

                <p:poll process="@this" interval="1" listener="#{sessionMb.ejemploContador()}" update=":formulario:panelSecundario" stop="#{!sessionMb.actualizarMonitor}" autoStart="true" widgetVar="poll" />
                <!--<p:remoteCommand id="remoteCommand" name="updatePoll" update=":formulario:panelSecundario"/>-->
                <p:remoteCommand name="onload" action="#{applicationCodefacMb.controladorConexionServidor()}" autoRun="true" />


                <p:growl id="messages" showDetail="true" life="5000"/>
                <!--- ============= PANELES AUXILIARES DERECHA, ABAJO ============= -->
                <p:sidebar widgetVar="sidebar1" baseZIndex="10000" class="leftCol">
                    <h1 style="font-weight:normal">Menu Principal</h1>
                    <p:commandButton value="Salir" style="width: 100%" oncomplete="PF('sidebar1').hide()"/>


                    <p:separator/>

                    <p:accordionPanel value="#{sessionMb.menuCodefacRespuesta.modulosDisponibles}" var="modulo" >

                        <p:tab title="#{modulo.nombre}">
                            <p:menu model="#{sessionMb.menuModelMap.get(modulo)}" toggleable="true" />
                        </p:tab>

                    </p:accordionPanel>

                </p:sidebar>

                <p:sidebar id="panelSecundario" widgetVar="sidebar4" position="right" baseZIndex="10000" style="width: 250px">
                    <h1 style="font-weight:normal">Comprobantes Procesados</h1>


                    <p:repeat id="barMonitor" value="#{sessionMb.barraProgresoList}" var="barra">
                        <p:separator />
                        <div class="p-grid">
                            <div class="p-col-7 ">
                                <p:progressBar   widgetVar="pbAjax" ajax="true" value="#{barra.porcentaje}"  labelTemplate="#{barra.titulo()}" styleClass="animated " style="border: 2px;border-style: inset;background-color:  darkcyan;font-size: 12px;font-weight: normal;font-family: monospace" global="false">
                                    <p:ajax event="complete"   oncomplete="PF('startButton2').enable()"/>
                                </p:progressBar>
                            </div>
                            <div class="p-col-5 " style="text-align: center">
                                <p:commandButton id="btnMonitorAlerta" process="@this"  icon="fa fa-bell-o" actionListener="#{barra.alerta()}"  />
                                <p:commandButton id="btnMonitorBuscar" process="@this" ajax="false" actionListener="#{barra.imprimir()}"  icon="fa fa-search"  />
                                <p:commandButton id="btnMonitorImprimir" process="@this" icon="fa fa-close"  />
                            </div>
                        </div>


                    </p:repeat>

                    <!--<p:commandButton value="Cancel" oncomplete="PF('sidebar4').hide()"/>-->
                </p:sidebar>

                <!-- ============== MENU SUPERIOR DE LAS OPCIONES PRINCIPALES ====== -->            
                <p:toolbar id="tb" style="cabecera" rendered="#{!controllerCodefacMb.modoDialogo}">
                    <f:facet name="left">
                        <p:commandButton icon="home-icon" process="@this" class="button-menu" title="Home" action="indexCodefac" />

                        <p:commandButton icon="new-icon" class="button-menu" title="Nuevo" process="@this" actionListener="#{controllerCodefacMb.nuevo()}" update="panelContenido">
                        </p:commandButton>

                        <!-- BOTON GRABAR -->
                        <p:commandButton icon="save-icon"  class="button-menu" type="button" onclick="PF('dialogConfirmarGrabar').show()" title="Grabar" disabled="false" >                                
                        </p:commandButton>

                        <!-- BOTON IMPRIMIR -->
                        <p:commandButton icon="print-icon" class="button-menu" title="Imprimir" ajax="false" actionListener="#{controllerCodefacMb.imprimir()}" update="messages" />

                        <!-- BOTON BUSCAR-->
                        <p:commandButton icon="find-icon" class="button-menu" process="@this" title="Buscar" actionListener="#{controllerCodefacMb.abrirDialogoBusqueda}" >
                            <p:ajax event="dialogReturn" listener="#{controllerCodefacMb.onObjectChosen}" update="panelContenido" />
                        </p:commandButton>

                        <!-- ELIMINAR BOTON -->
                        <p:commandButton icon="delete-icon" class="button-menu" type="button" onclick="PF('dialogConfirmarEliminar').show()" title="Eliminar" disabled="false" />


                        <!--<p:commandButton icon="refresh-icon" class="button-menu" title="Refrescar" disabled="true" />-->
                        <ui:insert name="btnAyuda">
                            <p:commandButton icon="help-icon" class="button-menu" title="Ayuda" actionListener="#{controllerCodefacMb.mostrarAyuda()}" update="panelSecundario" process="@this" disabled="false" />
                        </ui:insert>

                    </f:facet>   
                    <f:facet name="right">


                        <p:commandButton value="Menu" icon="fa fa-fw fa-bars" oncomplete="PF('sidebar1').show()" />
                        <p:commandButton value="%" icon="fa fa-fw fa-download" oncomplete="PF('sidebar4').show()" />
                        <p:menuButton value="Más">                            
                            <p:menuitem value="Cerrar la sesión" action="login" icon="pi pi-home" />
                        </p:menuButton>
                    </f:facet>
                </p:toolbar>
                <div style="text-align: center">
                    <p:commandButton rendered="#{controllerCodefacMb.modoDialogo}" process="@this" onclick="PF('dialogConfirmarGrabar').show()" style="float: contour;margin-bottom:  10px;margin-right: 50px" label="Grabar" value="G U A R D A R" icon="save-icon" />
                </div>
                <p:sticky target="tb" />


                <p:panel id="panelContenido" style="text-align: center">
                    <!-- =================== TITULO DE LA PAGINA ========================= -->
                    <div class="titulo_contenido" >
                        <p:outputLabel style="font-size: 17px" id="txtTituloPagina" value="#{controllerCodefacMb.getTituloPagina()}" />
                    </div>
                    <p:separator />

                    <!-- =================== CONTENIDO DONDE VAN A ESTAR LOS DATOS ========================= -->
                    <div  style="padding: 10px">
                        <ui:insert name="contenido">
                            Contenido por defecto de la plantilla  
                        </ui:insert>
                    </div>

                    <!-- ========================= PIE DE LA PAGINA ====================== -->
                    <div class="pie-pagina" >
                        Todos los derechos reservador Codefac 2018
                    </div> 
                </p:panel>

                <h:outputStylesheet name="primeflex/primeflex.css" library="css" />
                <h:outputStylesheet library="css" name="estilo.css" />

                <!-- DIALOGO PARA CONFIRMAR EL GUARDAR -->
                <p:confirmDialog message="Esta seguro que desea grabar los datos?" header="Alerta" severity="alert" widgetVar="dialogConfirmarGrabar">
                    <p:commandButton value="Si" process="@form" actionListener="#{controllerCodefacMb.save()}" update="messages,idDialogResultado,panelSecundario,panelContenido"  onclick="PF('dialogConfirmarGrabar').hide();"  />
                    <p:commandButton value="No" onclick="PF('dialogConfirmarGrabar').hide();" type="button" />
                </p:confirmDialog>

                <!-- DIALOGO DE RESULTADOS -->
                <p:dialog id="idDialogResultado" header="#{controllerCodefacMb.generalAbstractMb.resultadoDialogo.titulo}" widgetVar="dialogResultado" modal="true" height="100" style="text-align: center">
                    <h:graphicImage library="img" name="logoCodefac.gif" style="height: 50%" />
                    <p:separator />
                    <p:outputLabel value="#{controllerCodefacMb.generalAbstractMb.resultadoDialogo.mensaje}" />
                    <f:facet name="footer"  >
                        <div style="text-align: center">
                            <p:commandButton value="Aceptar" process="@form" actionListener="#{controllerCodefacMb.nuevo()}" update="messages,idDialogResultado,formulario:panelSecundario,panelContenido"  onclick="PF('dialogConfirmarGrabar').hide();"  />
                            <p:commandButton value="Imprimir" process="@this" ajax="false" actionListener="#{controllerCodefacMb.imprimir()}" icon="ui-icon-print" />
                        </div>
                    </f:facet>
                </p:dialog>

                <!-- DIALOGO PARA CONFIRMAR ELIMINAR -->
                <p:confirmDialog message="Esta seguro que desea eliminar el  registro?" header="Alerta" severity="alert" widgetVar="dialogConfirmarEliminar">
                    <p:commandButton value="Si" process="@form" actionListener="#{controllerCodefacMb.delete()}" update="messages,idDialogResultado,:formulario:panelSecundario,panelContenido"  onclick="PF('dialogConfirmarEliminar').hide();"  />
                    <p:commandButton value="No" onclick="PF('dialogConfirmarEliminar').hide();" type="button" />
                </p:confirmDialog>

            </h:form>


        </h:body>

    </f:view>
</html>

