<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui" 
      xmlns:c="http://xmlns.jcp.org/jsf/composite/componentes">

    <ui:composition  template="/template/codefac_template.xhtml">

        <ui:define name="contenido" >

            <f:event listener="#{controllerCodefacMb.agregarVista(proformaMb)}" type="preRenderView" />
            <p:remoteCommand name="updateDataTable" update=":formulario:tblProductoDetalles"/>

            <p:panelGrid columns="4" layout="grid">            
                <p:panel class="ui-inputgroup" style="border: 0px;margin: 0px;padding: 0px">
                    <p:inputText id="txtCliente" placeholder="Identificación Cliente" value="#{proformaMb.factura.cliente.identificacion}" style="width: 55%" />                    
                    <p:commandButton process="@this" icon="fa fa-search"  styleClass="white-button" action="#{proformaMb.abrirDialogoBuscarCliente}">
                        <p:ajax event="dialogReturn" listener="#{proformaMb.seleccionarCliente}" update="txtCliente,datosCliente"  />
                    </p:commandButton>                    
                    <p:commandButton process="@this" icon="fa fa-plus"  styleClass="white-button" action="#{proformaMb.abrirDialogoCrearCliente()}"/>                    
                </p:panel>

                <p:panel class="ui-inputgroup" style="border: 0px;margin: 0px;padding: 0px">
                    <p:datePicker  id="button" value="#{proformaMb.fechaEmision}" showIcon="true" placeholder="Fecha Emisión" />
                </p:panel>


                <p:panel class="ui-inputgroup" style="border: 0px;margin: 0px;padding: 0px">
                    <p:selectOneMenu id="car" value="#{proformaMb.documentoSeleccionado}" converter="documentoEnumConverter" >
                        <f:selectItems value="#{proformaMb.documentos}" var="documento" itemValue="#{documento.codigo}" />
                    </p:selectOneMenu>
                </p:panel>

                <p:panel class="ui-inputgroup" style="border: 0px;margin: 0px;padding: 0px">
                    <p:outputLabel value="Punto Emisión:" />
                    <p:selectOneMenu id="cmbPuntoEmision" value="#{proformaMb.puntoEmisionSeleccionado}" converter="puntoEmisionConverter" >
                        <f:selectItems value="#{proformaMb.puntosEmision}" var="puntoEmision" itemValue="#{puntoEmision.id.toString()}" />
                    </p:selectOneMenu>
                    <p:outputLabel value="" />
                </p:panel>


            </p:panelGrid>


            <p:panelGrid columns="2" layout="grid" id="datosCliente">      
                <p:panel style="border: none">
                    <h:outputLabel style="font-weight: bold">Razon Social:  </h:outputLabel>
                    <h:outputLabel>#{proformaMb.factura.cliente.razonSocial}</h:outputLabel>
                </p:panel>

                <p:panel style="border: none">
                    <h:outputLabel style="font-weight: bold">Dirección:  </h:outputLabel>
                    <h:outputLabel>#{proformaMb.factura.cliente.direccion}</h:outputLabel>
                </p:panel>

                <p:panel style="border: none">
                    <h:outputLabel style="font-weight: bold">Telefonos:  </h:outputLabel>
                    <h:outputLabel>#{proformaMb.factura.telefono}</h:outputLabel>
                </p:panel>

            </p:panelGrid>


            <p:panel>
                <p:ribbon>
                    <p:tab title="Productos">


                        <p:ribbonGroup style="width:22%" >
                            <p:inputText id="txtProducto" placeholder="Código" value="#{proformaMb.productoSeleccionado.codigoPersonalizado}" />
                            <p:commandButton  process="@this" icon="fa fa-search"  styleClass="white-button" action="#{proformaMb.abrirDialogoBusquedaProducto()}">
                                <p:ajax event="dialogReturn" listener="#{proformaMb.seleccionarProducto}" update="txtProducto,txtValorUnitario,txtCantidad,txtDescuento,txtDescripcion"  />
                            </p:commandButton>
                        </p:ribbonGroup>

                        <p:ribbonGroup style="width:15%" id="datosProducto">
                            <p:inputText id="txtValorUnitario" style="width: 100px" placeholder="Valor" value="#{proformaMb.facturaDetalle.precioUnitario}" />
                            <p:inputText id="txtCantidad" style="width: 100px" placeholder="Cantidad" value="#{proformaMb.facturaDetalle.cantidad}" />
                            <p:inputText id="txtDescuento" style="width: 100px" placeholder="Descuento" value="#{proformaMb.facturaDetalle.descuento}" />
                        </p:ribbonGroup>

                        <p:ribbonGroup style="width:45%">
                            <p:inputText style="width: 80%" id="txtDescripcion"  placeholder="Descripcion" value="#{proformaMb.facturaDetalle.descripcion}" />
                        </p:ribbonGroup>

                        <p:ribbonGroup style="width:12%">
                            <p:commandButton process="@this,txtValorUnitario,txtCantidad,txtDescuento" update="txtProducto,txtValorUnitario,txtCantidad,txtDescuento,txtDescripcion,:formulario:tblProductoDetalles,:formulario:messages" icon="fa fa-plus"   styleClass="white-button" action="#{proformaMb.agregarProducto()}" />
                            <p:commandButton process="@this" icon="fa fa-pencil"  styleClass="white-button" action="#{proformaMb.abrirDialogoBuscarCliente}"/>
                            <p:commandButton process="@this" icon="fa fa-close"  styleClass="white-button" action="#{proformaMb.abrirDialogoBuscarCliente}"/>
                        </p:ribbonGroup>
                                                                        
                    </p:tab>

                    <p:tab title="View">

                    </p:tab>
                </p:ribbon>

                <p:dataTable id="tblProductoDetalles" var="detalle" value="#{proformaMb.factura.detalles}" editable="true"  style="margin-bottom:20px">
                    <f:facet name="header">
                        Detalles Factura
                    </f:facet>

                    <p:ajax event="rowEdit" oncomplete="updateDataTable()"  listener="#{proformaMb.filaEditaTablaEvent}"  />
                    
                    <p:column headerText="Descripción" style="width: 50%">
                        <p:cellEditor>
                            <f:facet name="output"><h:outputText value="#{detalle.descripcion}" /></f:facet>
                            <f:facet name="input"><p:inputText id="modelInput2" value="#{detalle.descripcion}" style="width:100%"/></f:facet>
                        </p:cellEditor>
                    </p:column>


                    <p:column headerText="Valor Unit">
                        <p:cellEditor>
                            <f:facet name="output"><h:outputText value="#{detalle.precioUnitario}" /></f:facet>
                            <f:facet name="input"><p:inputText id="modelInput3" value="#{detalle.precioUnitario}" style="width:100%"/></f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Cantidad">
                        <p:cellEditor>
                            <f:facet name="output"><h:outputText value="#{detalle.cantidad}" /></f:facet>
                            <f:facet name="input"><p:inputText id="modelInput6" value="#{detalle.cantidad}" style="width:100%"/></f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Descuento">
                        <p:cellEditor>
                            <f:facet name="output"><h:outputText value="#{detalle.descuento}" /></f:facet>
                            <f:facet name="input"><p:inputText  id="modelInput19" value="#{detalle.descuento}" style="width:100%"/></f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Total">
                        <p:cellEditor>
                            <f:facet name="output"><h:outputText value="#{detalle.total}" /></f:facet>
                            <f:facet name="input"><p:inputText disabled="true" id="modelInput5" value="#{detalle.total}" style="width:100%"/></f:facet>
                        </p:cellEditor>
                    </p:column>


                    <p:column style="width:35px">
                        <p:rowEditor />
                    </p:column>

                    <p:column style="width:35px">
                        <p:commandButton ajax="true" icon=" fa fa-close" label="Eliminar item" action="#{proformaMb.eliminarFilaProducto(detalle)}" update="tblProductoDetalles" />
                    </p:column>

                   

                    <f:facet name="footer">
                        <p:panelGrid columns="4" layout="grid" id="totalesTabla">
                            <p:panel>
                                <h:outputLabel style="font-weight: bold">Subtotal 12: </h:outputLabel>
                                <h:outputLabel style="font-weight: normal" value="#{proformaMb.factura.subtotalImpuestos}" />
                            </p:panel>

                            <p:panel>
                                <h:outputLabel style="font-weight: bold">Subtotal 0: </h:outputLabel>
                                <h:outputLabel style="font-weight: normal" value="#{proformaMb.factura.subtotalSinImpuestos}" />
                            </p:panel>

                            <p:panel>
                                <h:outputLabel style="font-weight: bold">Descuento: </h:outputLabel>
                                <h:outputLabel style="font-weight: normal" value="#{proformaMb.factura.descuentoImpuestos}" />
                            </p:panel>
                            <p:panel>
                                <h:outputLabel style="font-weight: bold">IVA: </h:outputLabel>
                                <h:outputLabel style="font-weight: normal" value="#{proformaMb.factura.iva}" />
                            </p:panel>
                        </p:panelGrid>
                        <p:panel>
                            <h:outputLabel style="font-weight: bold;font-size: 18px">Total: </h:outputLabel>
                            <h:outputLabel style="font-weight: normal;font-size: 18px" value="#{proformaMb.factura.total}" />
                        </p:panel>
                    </f:facet>
                </p:dataTable>
            </p:panel>

       
        </ui:define>
    </ui:composition>

</html>

